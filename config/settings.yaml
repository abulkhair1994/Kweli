# Impact Learners ETL Configuration

etl:
  chunk_size: 50000  # Rows to process per chunk (5x increase for performance)
  batch_size: 5000   # Records to send to Neo4j per batch (5x increase for performance)
  num_workers: 8     # Parallel workers for batch flushing (optimized for multi-core)

  # Resume capability
  enable_checkpoints: true
  checkpoint_interval: 5000  # Save checkpoint every N rows

  # Progress tracking
  enable_progress_bar: false  # Disabled for maximum performance
  log_interval: 10000  # Log progress every N rows (reduced frequency)

neo4j:
  # Connection details
  uri: "bolt://localhost:7688"
  user: "neo4j"
  password: "password123"

  # Connection pooling
  max_connection_pool_size: 100  # Increased for parallel operations (num_workers * 10+)
  connection_timeout: 30  # seconds
  max_transaction_retry_time: 30  # seconds

  # Batch operations
  batch_size: 5000  # Match ETL batch size for optimal performance
  batch_timeout: 90  # seconds (increased for larger batches)

validation:
  # Data quality thresholds
  max_error_rate: 0.05  # 5% max errors allowed
  required_fields:
    - sand_id
    - hashed_email
    - full_name

  # Date validation
  min_year: 1970
  max_year: 2030
  invalid_date_markers:
    - "1970-01-01"
    - "9999-12-31"

  # Numeric validation
  missing_value_markers:
    - -99
    - "-99"

transformers:
  # Skills parsing
  skills:
    delimiter: ","
    normalize: true
    max_skills_per_learner: 50

  # Geographic data
  geography:
    use_hybrid_approach: true  # Store as property + create nodes
    normalize_country_codes: true
    strict_country_validation: false  # Fail on unmapped countries (recommended: true for production)
    auto_generate_codes: true  # Fallback to [:2] for unmapped countries (disable in strict mode)
    required_mapping_coverage: 0.95  # Warn if <95% of countries are mapped

  # Temporal state tracking
  temporal:
    # Basic temporal tracking (snapshot mode)
    enable_learning_state_tracking: true
    enable_professional_status_tracking: true
    default_snapshot_date: "2025-10-06"

    # Temporal history tracking (SCD Type 2 mode)
    enable_learning_state_history: true  # Build full history from learning_details
    enable_professional_status_history: true  # Build full history from employment_details
    inactive_gap_months: 6  # Gap to consider learner inactive between programs
    unemployment_gap_months: 1  # Gap to consider unemployed between jobs
    infer_initial_unemployment: true  # Create unemployed status before first job

logging:
  level: INFO
  format: json
  handlers:
    - type: file
      filename: "data/logs/etl_{timestamp}.log"
    - type: console
      stream: stdout
